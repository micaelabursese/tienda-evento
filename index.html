<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pedidos Evento</title>
<style>
  body{font-family:Inter,Arial,Helvetica,sans-serif;background:#f5f5f5;padding:20px}
  .container{max-width:480px;margin:20px auto;background:#fff;padding:24px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.08)}
  h1{font-size:18px;text-align:center;margin:0 0 14px}
  label{display:block;margin-top:12px;font-weight:600}
  input[type="text"],input[type="number"],input[type="file"]{width:100%;padding:10px;border-radius:8px;border:1px solid #dcdcdc;margin-top:6px;box-sizing:border-box}
  .row{display:flex;gap:10px;align-items:center}
  .row label{flex:1}
  .row input[type="number"]{width:120px}
  .total-box{margin-top:18px;padding:12px;background:#fafafa;border-radius:8px;text-align:center;font-weight:700}
  .alias{margin-top:12px}
  button{width:100%;padding:12px;margin-top:18px;background:#111;color:#fff;border:none;border-radius:10px;font-size:16px;cursor:pointer}
  .success{display:none;margin-top:14px;text-align:center;color:green;font-weight:700}
</style>
</head>
<body>
  <div class="container">
    <h1>ELEGI CANTIDAD DE LA OPCIÓN U OPCIONES QUE QUIERAS PEDIR.<br>EL VALOR ES DE 13K CADA UNA.<br>SERÁN ENTREGADAS EN EL EVENTO.</h1>

    <label>Nombre completo</label>
    <input id="nombre" type="text" placeholder="Nombre y apellido" />

    <div class="row">
      <label>MIAMI</label>
      <input id="miami" type="number" min="0" value="0" />
    </div>

    <div class="row">
      <label>DJ</label>
      <input id="dj" type="number" min="0" value="0" />
    </div>

    <div class="row">
      <label>PEGASUS</label>
      <input id="pegasus" type="number" min="0" value="0" />
    </div>

    <div class="total-box">Total: <span id="total">0</span> ARS</div>

    <div class="alias"><strong>Alias donde transferir:</strong> lucas.medina.trap</div>

    <label style="margin-top:12px">Cargar comprobante</label>
    <input id="comprobante" type="file" accept="image/*" />

    <button id="btnEnviar">Enviar pedido</button>

    <div id="mensaje" class="success">¡GRACIAS! EL PEDIDO FUE CARGADO.</div>
  </div>

<script>
const precio = 13000;
const endpoint = "https://script.google.com/macros/s/AKfycbwL6PXSrdvtIod6M-J3tM96Xp8xQCJKuUbGGNtDju0zUTt8jnvS_K3i9FKiE4GHBnh-/exec"; // <--- Pegá aquí la URL del Apps Script (doPost)

function actualizarTotal(){
  const miami = parseInt(document.getElementById('miami').value) || 0;
  const dj = parseInt(document.getElementById('dj').value) || 0;
  const peg = parseInt(document.getElementById('pegasus').value) || 0;
  const total = (miami + dj + peg) * precio;
  document.getElementById('total').innerText = total.toLocaleString('es-AR');
}

document.querySelectorAll("input[type='number']").forEach(i=>i.addEventListener('input', actualizarTotal));
actualizarTotal();

document.getElementById('btnEnviar').addEventListener('click', async function(){
  const nombre = document.getElementById('nombre').value.trim();
  if(!nombre){ alert('Ingresá nombre completo'); return; }

  const miami = parseInt(document.getElementById('miami').value) || 0;
  const dj = parseInt(document.getElementById('dj').value) || 0;
  const pegasus = parseInt(document.getElementById('pegasus').value) || 0;
  const total = (miami + dj + pegasus) * precio;

  const fileInput = document.getElementById('comprobante');
  const file = fileInput.files[0];

  let comprobanteBase64 = "";
  let comprobanteName = "";

  if(file){
    comprobanteName = file.name;
    // leer base64
    comprobanteBase64 = await new Promise((res, rej) => {
      const fr = new FileReader();
      fr.onload = () => {
        const dataUrl = fr.result;
        const base64 = dataUrl.split(',')[1];
        res(base64);
      };
      fr.onerror = rej;
      fr.readAsDataURL(file);
    });
  }

  const payload = {
    nombre,
    miami,
    dj,
    pegasus,
    total,
    comprobanteBase64,
    comprobanteName
  };

  // enviar al endpoint (Apps Script)
  try{
    await fetch(endpoint, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    document.getElementById('mensaje').style.display = 'block';
    // reset
    document.getElementById('nombre').value = '';
    document.getElementById('miami').value = 0;
    document.getElementById('dj').value = 0;
    document.getElementById('pegasus').value = 0;
    document.getElementById('comprobante').value = '';
    actualizarTotal();
  }catch(err){
    alert('Error al enviar, revisá la consola. ' + err);
    console.error(err);
  }
});
</script>
</body>
</html>
